<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Weather Dashboard</title>
    <!-- Use older versions of libraries for better compatibility -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.0.4/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/weather-icons/2.0.10/css/weather-icons.min.css">
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            overscroll-behavior: none;
            background: #1a202c;
            color: #fff;
            -webkit-text-size-adjust: 100%;
        }
        .glass {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        #app {
            height: 100vh;
            max-height: 100vh;
        }
        .grid-container {
            height: calc(100vh - 1rem);
            max-height: calc(100vh - 1rem);
        }
        /* Optimize touch targets for mobile */
        button, a {
            min-height: 44px;
            min-width: 44px;
        }
        /* Prevent text selection */
        * {
            -webkit-user-select: none;
            user-select: none;
        }
        /* Larger clock for visibility */
        .clock-text {
            font-size: 5rem;
            line-height: 1;
        }
        .date-text {
            font-size: 1.5rem;
            line-height: 1.2;
        }
        @media (max-width: 640px) {
            .clock-text {
                font-size: 3.5rem;
            }
            .date-text {
                font-size: 1.2rem;
            }
        }
    </style>
</head>
<body>
    <div id="app" class="p-2">
        <div class="grid grid-container grid-cols-1 md:grid-cols-12 gap-2">
            <!-- Clock and Date -->
            <div class="md:col-span-4 glass rounded-lg p-3 flex flex-col items-center justify-center">
                <div class="clock-text font-light text-center" v-cloak>
                    {{ currentTime }}
                </div>
                <div class="date-text text-gray-400 text-center mt-2" v-cloak>
                    {{ currentDate }}
                </div>
                <div class="text-sm text-gray-400 mt-2" v-cloak>
                    {{ location }}
                </div>
            </div>

            <!-- Weather Maps -->
            <div class="md:col-span-8 grid grid-cols-1 md:grid-cols-2 gap-2">
                <!-- Radar Map -->
                <div class="glass rounded-lg overflow-hidden" style="height: 35vh">
                    <iframe width="100%" height="100%" 
                            :src="'https://embed.windy.com/embed2.html?lat=' + lat + '&lon=' + lon + '&zoom=8&level=surface&overlay=radar&menu=&message=true&marker=&calendar=&pressure=&type=map&location=coordinates&detail=&metricWind=default&metricTemp=default&radarRange=-1'" 
                            frameborder="0"></iframe>
                </div>
                <!-- Temperature Map -->
                <div class="glass rounded-lg overflow-hidden" style="height: 35vh">
                    <iframe width="100%" height="100%" 
                            :src="'https://embed.windy.com/embed2.html?lat=' + lat + '&lon=' + lon + '&zoom=8&level=surface&overlay=temp&menu=&message=true&marker=&calendar=&pressure=&type=map&location=coordinates&detail=&metricWind=default&metricTemp=default&radarRange=-1'" 
                            frameborder="0"></iframe>
                </div>
            </div>

            <!-- Current Weather -->
            <div class="md:col-span-4 glass rounded-lg p-3">
                <div class="flex items-center justify-between">
                    <div>
                        <h1 class="text-4xl font-light mb-1">{{ currentTemp }}°</h1>
                        <p class="text-lg text-gray-400">{{ description }}</p>
                        <div class="mt-2 space-y-1 text-sm">
                            <p>Feels like {{ feelsLike }}°</p>
                            <p>Humidity: {{ humidity }}%</p>
                            <p>Wind: {{ windSpeed }} mph</p>
                        </div>
                    </div>
                    <i :class="weatherIcon" class="wi text-5xl"></i>
                </div>
            </div>

            <!-- Combined Forecasts -->
            <div class="md:col-span-8 glass rounded-lg p-3">
                <!-- Hourly Forecast -->
                <div class="mb-4">
                    <h2 class="text-lg mb-2">Next 12 Hours</h2>
                    <div class="flex space-x-4 overflow-x-auto scrollbar-hide pb-2">
                        <div v-for="hour in hourlyForecast.slice(0,12)" 
                             class="flex flex-col items-center min-w-[60px]">
                            <span class="text-sm text-gray-400">{{ hour.time }}</span>
                            <i :class="hour.icon" class="wi text-2xl my-1"></i>
                            <span class="text-lg">{{ hour.temp }}°</span>
                        </div>
                    </div>
                </div>

                <!-- 5 Day Forecast -->
                <div>
                    <h2 class="text-lg mb-2">5 Day Forecast</h2>
                    <div class="space-y-3">
                        <div v-for="day in dailyForecast" 
                             class="flex items-center justify-between">
                            <span class="text-lg text-gray-400">{{ day.date }}</span>
                            <i :class="day.icon" class="wi text-2xl"></i>
                            <div class="text-right">
                                <span class="text-sm text-gray-400">{{ day.min }}°</span>
                                <span class="text-lg"> / </span>
                                <span class="text-lg">{{ day.max }}°</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        new Vue({
            el: '#app',
            data: {
                currentTime: '',
                currentDate: '',
                currentTemp: '--',
                description: 'Loading...',
                feelsLike: '--',
                humidity: '--',
                windSpeed: '--',
                weatherIcon: 'wi wi-day-sunny',
                hourlyForecast: [],
                dailyForecast: [],
                lat: 39.704,
                lon: -77.329,
                location: 'Loading location...',
                locationError: false
            },
            created() {
                this.getLocation();
                this.startClock();
                this.fetchWeather();
                setInterval(this.fetchWeather, 300000);
            },
            methods: {
                getLocation() {
                    if ("geolocation" in navigator) {
                        navigator.geolocation.getCurrentPosition(
                            position => {
                                this.lat = position.coords.latitude;
                                this.lon = position.coords.longitude;
                                this.fetchLocationName();
                                this.fetchWeather();
                            },
                            error => {
                                console.error('Geolocation error:', error);
                                this.location = 'Using default location';
                                this.fetchWeather();
                            }
                        );
                    }
                },
                fetchLocationName() {
                    fetch(`https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${this.lat}&longitude=${this.lon}&localityLanguage=en`)
                        .then(response => response.json())
                        .then(data => {
                            this.location = data.city || data.locality || 'Unknown Location';
                        })
                        .catch(error => {
                            console.error('Location name error:', error);
                            this.location = 'Location unavailable';
                        });
                },
                startClock() {
                    const updateDateTime = () => {
                        const now = new Date();
                        this.currentTime = now.toLocaleTimeString('en-US', {
                            hour: 'numeric',
                            minute: '2-digit',
                            hour12: true
                        });
                        this.currentDate = now.toLocaleDateString('en-US', {
                            weekday: 'long',
                            month: 'long',
                            day: 'numeric'
                        });
                    };
                    updateDateTime();
                    setInterval(updateDateTime, 1000);
                },
                fetchWeather() {
                    const url = `https://api.open-meteo.com/v1/forecast?latitude=${this.lat}&longitude=${this.lon}&hourly=temperature_2m,weathercode,relativehumidity_2m,windspeed_10m&daily=temperature_2m_max,temperature_2m_min,weathercode&current_weather=true&temperature_unit=fahrenheit&windspeed_unit=mph&precipitation_unit=inch&timezone=auto`;
                    
                    fetch(url)
                        .then(response => response.json())
                        .then(data => this.updateWeatherData(data))
                        .catch(error => {
                            console.error('Weather error:', error);
                            this.description = 'Error loading weather';
                        });
                },
                updateWeatherData(data) {
                    try {
                        const currentHour = new Date().getHours();
                        
                        this.currentTemp = Math.round(data.current_weather.temperature);
                        this.weatherIcon = this.getWeatherIcon(data.current_weather.weathercode);
                        this.windSpeed = Math.round(data.current_weather.windspeed);
                        this.humidity = data.hourly.relativehumidity_2m[currentHour];
                        this.description = this.getWeatherDescription(data.current_weather.weathercode);
                        this.feelsLike = Math.round(data.hourly.temperature_2m[currentHour]);

                        this.hourlyForecast = [];
                        for (let i = currentHour; i < currentHour + 24; i++) {
                            this.hourlyForecast.push({
                                time: new Date(data.hourly.time[i]).toLocaleTimeString('en-US', {
                                    hour: 'numeric',
                                    hour12: true
                                }),
                                temp: Math.round(data.hourly.temperature_2m[i]),
                                icon: this.getWeatherIcon(data.hourly.weathercode[i])
                            });
                        }

                        this.dailyForecast = [];
                        for (let i = 0; i < data.daily.time.length; i++) {
                            this.dailyForecast.push({
                                date: new Date(data.daily.time[i]).toLocaleDateString('en-US', {
                                    weekday: 'long'
                                }),
                                max: Math.round(data.daily.temperature_2m_max[i]),
                                min: Math.round(data.daily.temperature_2m_min[i]),
                                icon: this.getWeatherIcon(data.daily.weathercode[i])
                            });
                        }
                    } catch (error) {
                        console.error('Data processing error:', error);
                        this.description = 'Error processing weather data';
                    }
                },
                getWeatherIcon(code) {
                    const icons = {
                        0: 'wi-day-sunny',
                        1: 'wi-day-cloudy-high',
                        2: 'wi-day-cloudy',
                        3: 'wi-cloudy',
                        45: 'wi-fog',
                        48: 'wi-fog',
                        51: 'wi-sprinkle',
                        53: 'wi-showers',
                        55: 'wi-rain',
                        61: 'wi-rain',
                        63: 'wi-rain-mix',
                        65: 'wi-rain-wind',
                        71: 'wi-snow',
                        73: 'wi-snow',
                        75: 'wi-snow-wind',
                        77: 'wi-sleet',
                        80: 'wi-showers',
                        81: 'wi-rain',
                        82: 'wi-rain-wind',
                        85: 'wi-snow',
                        86: 'wi-snow-wind',
                        95: 'wi-thunderstorm',
                        96: 'wi-storm-showers',
                        99: 'wi-storm-warning'
                    };
                    return `wi ${icons[code] || 'wi-day-sunny'}`;
                },
                getWeatherDescription(code) {
                    const descriptions = {
                        0: 'Clear Sky',
                        1: 'Mostly Clear',
                        2: 'Partly Cloudy',
                        3: 'Cloudy',
                        45: 'Foggy',
                        48: 'Freezing Fog',
                        51: 'Light Drizzle',
                        53: 'Drizzle',
                        55: 'Heavy Drizzle',
                        61: 'Light Rain',
                        63: 'Rain',
                        65: 'Heavy Rain',
                        71: 'Light Snow',
                        73: 'Snow',
                        75: 'Heavy Snow',
                        77: 'Snow Grains',
                        80: 'Light Showers',
                        81: 'Showers',
                        82: 'Heavy Showers',
                        85: 'Light Snow Showers',
                        86: 'Snow Showers',
                        95: 'Thunderstorm',
                        96: 'Thunderstorm with Hail',
                        99: 'Severe Thunderstorm'
                    };
                    return descriptions[code] || 'Clear';
                }
            }
        });
    </script>
</body>
</html>
